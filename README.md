# Multi-Platform AI Bot

A versatile AI-powered bot that operates across Twitter, Discord, Telegram platforms. The bot uses advanced language models to generate contextual responses while maintaining a unique personality.

## Features

- ü§ñ Multi-platform support (Twitter, Discord, Telegram)
- üß† AI-powered responses using advanced language models
- üíæ Persistent memory system for context-aware conversations
- üìö Story circle narrative progression
- üîÑ Session management for Twitter interactions
- üóÑÔ∏è Supabase database integration for persistent storage

## Prerequisites

- Python 3.8+
- Selenium WebDriver (for Twitter bot)
- API keys for respective platforms
- GLHF API access
- Supabase account and project

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd <repository-name>
```

2. Create and activate a virtual environment:
```bash
# On Windows
python -m venv venv
venv\Scripts\activate

# On macOS/Linux
python -m venv venv
source venv/bin/activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

4. Set up Selenium WebDriver (for Twitter bot):
   - Download [ChromeDriver](https://sites.google.com/chromium.org/driver/) matching your Chrome version
   - Add ChromeDriver to your system PATH

5. Configure environment variables:
```bash
cp .env.template .env
```

## Configuration

1. Edit the `.env` file with your credentials:
   - Get GLHF API key from [GLHF Chat](https://glhf.chat)
   - Create a [Telegram Bot](https://core.telegram.org/bots#creating-a-new-bot) and get the token
   - Set up your Telegram chat ID (see Telegram Setup below)
   - Set up a [Discord Application](https://discord.com/developers/applications) and get the bot token
   - Add your Twitter credentials
   - Set up Supabase (see Database Setup below)

### Telegram Setup
1. Add your bot to the desired Telegram chat/group
2. Use the `/chatid` command in the chat where you want the bot to operate
3. The bot will respond with the chat ID
4. Add this chat ID to your `.env` file as `TELEGRAM_CHAT_ID`

Alternatively, you can:
1. Add your bot to the chat/group
2. Send any message to the chat
3. Visit `https://api.telegram.org/bot<YourBOTToken>/getUpdates`
4. Look for the `"chat":{"id":` field in the response
5. Use that ID in your `.env` file

2. Configure bot settings:
   - Adjust model parameters in `.env` if needed
   - Set memory limits and other preferences
   - Customize bot usernames if desired

## Database Setup

1. Create a Supabase Project:
   - Go to [Supabase](https://supabase.com) and create a new project
   - Note down your project URL and anon/public key

2. Set up required tables:
```sql
-- Create memories table
create table memories (
  id bigint generated by default as identity primary key,
  content text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create story_circle table
create table story_circle (
  id bigint generated by default as identity primary key,
  narrative jsonb not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create circle_memories table
create table circle_memories (
  id bigint generated by default as identity primary key,
  memories jsonb not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create emotion_formats table
create table emotion_formats (
  id bigint generated by default as identity primary key,
  format text not null,
  description text not null
);

-- Create length_formats table
create table length_formats (
  id bigint generated by default as identity primary key,
  format text not null,
  description text not null
);

-- Create topics table
create table topics (
  id bigint generated by default as identity primary key,
  topic text not null
);

-- Create processed_tweets table
create table processed_tweets (
  id bigint generated by default as identity primary key,
  tweet_id text not null unique
);
```

3. Configure Database Access:
   - Add your Supabase URL and anon key to `.env`:
   ```
   SUPABASE_URL=your_project_url
   SUPABASE_KEY=your_anon_key
   ```
   - The URL looks like: `https://[project-ref].supabase.co`
   - The key starts with `eyJ...`

4. Initialize Database (Optional):
```bash
python migration_script.py
```
This will populate initial data for emotion formats, length formats, and other required tables.

## Running the Bots

### Running All Bots
```bash
python main.py
```

### Running Individual Bots
```bash
# Twitter Bot only..
python main.py -- bots twitter

# Discord Bot only
python main.py --bots discord

# Telegram Bot only
python main.py --bots telegram

   python main.py --bots twitter telegram
```

### Development Mode
```bash
# Run with debug logging
python main.py --debug
```

## Bot Features and Commands

### Discord Commands
- `!help` - Show available commands
- `!chat [message]` - Chat with the bot
- `!memory` - View bot's memories

### Telegram Commands
- `/start` - Begin interaction
- `/chat [message]` - Chat with the bot
- `/help` - Show available commands

### Twitter Features
- Auto-replies to mentions
- Periodic tweet generation
- Context-aware conversations
- Session management

## Project Structure
```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ twitter_bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authenticator.py    # Twitter authentication
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tweets.py          # Tweet management
‚îÇ   ‚îú‚îÄ‚îÄ discord_bot/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ discord_bot.py     # Discord bot implementation
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram_bot.py    # Telegram bot implementation
‚îÇ   ‚îú‚îÄ‚îÄ ai_generator.py        # AI response generation
‚îÇ   ‚îú‚îÄ‚îÄ config.py             # Configuration management
‚îÇ   ‚îú‚îÄ‚îÄ memory_processor.py   # Memory management
‚îÇ   ‚îî‚îÄ‚îÄ utils.py             # Utility functions
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ processed_tweets.txt  # Tweet history
‚îú‚îÄ‚îÄ requirements.txt         # Python dependencies
‚îú‚îÄ‚îÄ .env.template           # Environment template
‚îî‚îÄ‚îÄ main.py                # Entry point
```

## Troubleshooting

### Common Issues

1. Twitter Authentication:
```bash
# If sessions are not working, try:
python main.py --twitter --reset-session
```

2. Discord Connection:
- Ensure bot has proper permissions in server
- Check if token is valid
- Verify internet connection

3. Telegram Issues:
- Confirm bot token is active
- Check bot privacy settings

### Logs
Check logs for detailed error information:
```bash
tail -f logs/bot.log
```

## Contributing

1. Fork the repository
2. Create your feature branch:
```bash
git checkout -b feature/amazing-feature
```
3. Commit your changes:
```bash
git commit -m 'Add amazing feature'
```
4. Push to the branch:
```bash
git push origin feature/amazing-feature
```
5. Open a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Acknowledgments

- GLHF Chat for AI API access
- OpenAI for model architectures
- Selenium for web automation
- Discord.py, python-telegram-bot for platform SDKs

## Database Management Commands

### Clear Database
To clear all data from the database tables:
```bash
python migrations/clear_database.py
```

### Run Database Migration
To migrate story circle data to Supabase:
```bash
python migrations/story_circle_supabase_migration.py
```

### Run Tests
To run the story progression tests:
```bash
python -m pytest tests/test_story_cricle_integration.py -v
```

### Database Management Flow
When setting up or resetting the database, follow this order:
1. Clear the database first
2. Run the migration
3. Run tests to verify everything is working

Example:
```bash




## Run these queries to clean database completely on Supabase before running a test

DELETE FROM circle_memories;
DELETE FROM events_dialogues;
DELETE FROM story_phases;
DELETE FROM story_circle;

-- Then reset the sequences
ALTER SEQUENCE circle_memories_id_seq RESTART WITH 1;
ALTER SEQUENCE events_dialogues_id_seq RESTART WITH 1;
ALTER SEQUENCE story_phases_id_seq RESTART WITH 1;
ALTER SEQUENCE story_circle_id_seq RESTART WITH 1;


# Run tests
python -m tests.test_story_circle_integration

Note: Make sure you have all required environment variables set in your `.env` file before running these commands.+

# Memory Upload Instructions

## Uploading Memories to Database

The project includes a script to upload memories from `data/new_memories.txt` to the Supabase database. Here's how to use it:

1. Ensure your memories are in `data/new_memories.txt`, with one memory per line
2. Run the upload script:

```bash
# From project root directory
python -m src.scripts.upload_memories
```

The script will:
- Read all memories from new_memories.txt
- Upload them to the Supabase 'memories' table
- Log the results to console

### Requirements
- Valid Supabase credentials in your environment variables
- Python 3.7+
- Required packages installed (see requirements.txt)

### Troubleshooting
- Check logs for detailed error messages
- Ensure your Supabase credentials are correct
- Verify the memories file exists and is readable




aaaa